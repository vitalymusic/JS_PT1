<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API</title>
</head>
<body>
        <h1>Ka programmēt izmantojot API</h1>
        <h2>API - Application Programming Interface</h2>

        <button onclick="ieladetProduktus()">Ielādēt produktus</button>

        <div class="categories">

        </div>
        <div class="search">
            <input type="text" name="productName" id="productName">
        </div>

        <div class="products">

        </div>

        <footer>
            <form enctype="multipart/form-data">
                <input type="text" name="name" id="name">
                <input type="email" name="email" id="email">
                <textarea name="message" id="message"></textarea>
                <input type="file" name="file" id="file">
                <input type="submit" value="Nosūtīt">
            </form>

        </footer>


        <script>
            let produktiUrl = "https://dummyjson.com/products";
            function ieladetProduktus(){
                fetch(produktiUrl)
                .then((atbilde)=>{ return atbilde.json()})
                .then((dati)=>{
                    // console.log(dati)
                    izvaditProduktus(dati);

                }).finally(()=>{
                    alert("dati ir ielādēti");
                })
            }

            function izvaditProduktus(dati){
                    let html = "";
                    for( product of dati.products){
                        html +=`
                            <div class="product">
                                <h3>${product.title}</h3>
                                <p>Apraksts: ${product.description}</p>
                                <p>Cena: ${product.price}</p>
                                <img src="${product.thumbnail}"> 
                                <div class="images">

                                </div>
                                <button data-id="${product.id} data-name="">Nopirkt</button>
                            </div>    

                        `
                           
                    document.querySelector('.products').innerHTML = html;
                    for(image of product.images){
                                  document.querySelector('.images').innerHTML+=`
                                    <img src="${image}" width="150">
                                  `  
                        }
                    }   
            }
            // Produktu kategoriju ielāde

            fetch('https://dummyjson.com/products/category-list')
            .then((resp)=>{ return resp.json()})
            .then(
                (dati)=>{
                    dati.forEach((elem)=>{
                        document.querySelector('.categories').innerHTML +=`
                            <button data-category="${elem}" class="categoryButton">${elem}</button>
                        `;
                    })

                }
            ).then(()=>{
                buttons = document.querySelectorAll('.categoryButton');
                for(button of buttons){
                    button.onclick = (event)=>{
                        catName = event.target.dataset.category;
                        // alert(catName);
                        fetch('https://dummyjson.com/products/category/'+ catName)
                         .then((atbilde)=>{ return atbilde.json()})
                         .then((produkti)=>{ izvaditProduktus(produkti)})
                    }
                }
            })

            document.querySelector('#productName').oninput = (e)=>{
                if(e.target.value.length >3){
                    fetch(`https://dummyjson.com/products/search?q=${e.target.value}`)
                            .then((atbilde)=>{ return atbilde.json()})
                            .then((produkti)=>{ izvaditProduktus(produkti)})
                }
        }




        // Kontaktu formas datu nosūtīšana
        //https://www.formbackend.com/f/cd3bf4aeeea3cc03


        let form = document.querySelector('form');
        form.onsubmit  = (e)=>{
            e.preventDefault();
            let data = new FormData(form);
            fetch('https://www.formbackend.com/f/cd3bf4aeeea3cc03',{
                  method: "POST",
                  body:data,
                  headers:{
                     Accept: "application/json",

                  }
            })
            .then((resp)=>{return resp.json()})
            .then((data)=>{
                console.log(data);
                if(data.errors.length == 0){
                    form.reset();
                    pazinojums("Dati nosūtīti");
                }
            })
        }

        function pazinojums(text){
                // Uztaisīt paziņojumu (<div class="alert">)
                // Pec 5 sekundēm paziņojums pazūd
                // *Animācija

                alert(text);
        };
        </script>

        <!-- Sataisīt produktu un pogu un ievades lauka dizainu ar CSS -->
</body>
</html>